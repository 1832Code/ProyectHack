name: Deploy Hackathon Services to Cloud Run

on:
  push:
    branches:
      - analytics
    paths:
      - 'hackathon/**'
      - '.github/workflows/deploy-hackathon.yml'
  workflow_dispatch:

env:
  GCP_PROJECT_ID: ${{ secrets.GCP_PROJECT_ID }}
  GCP_REGION: ${{ secrets.GCP_REGION || 'us-central1' }}
  APIFY_API_TOKEN: ${{ secrets.APIFY_API_TOKEN }}
  DEEPSEEK_API: ${{ secrets.DEEPSEEK_API }}
  DEBUG: ${{ secrets.DEBUG || '' }}

jobs:
  deploy-company-lookup:
    name: Deploy Company Lookup API
    runs-on: ubuntu-latest
    
    if: github.event_name == 'push' || github.event_name == 'workflow_dispatch'
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Prepare Google Service Account JSON
        id: prepare-json
        run: |
          SECRET_VALUE="${{ secrets.GOOGLE_JSON }}"
          if [ -z "$SECRET_VALUE" ]; then
            echo "❌ Error: GOOGLE_JSON secret is empty or not set"
            exit 1
          fi
          if echo "$SECRET_VALUE" | base64 -d > /tmp/gcp-sa-key.json 2>/dev/null && [ -s /tmp/gcp-sa-key.json ]; then
            echo "✅ Decoded from base64"
          else
            echo "$SECRET_VALUE" > /tmp/gcp-sa-key.json
            echo "✅ Used as plain JSON"
          fi
          if [ ! -s /tmp/gcp-sa-key.json ]; then
            echo "❌ Error: Failed to prepare credentials file"
            exit 1
          fi
          delimiter="EOF_$(date +%s)_$$"
          echo "credentials_json<<${delimiter}" >> $GITHUB_OUTPUT
          cat /tmp/gcp-sa-key.json >> $GITHUB_OUTPUT
          echo "${delimiter}" >> $GITHUB_OUTPUT

      - name: Authenticate to Google Cloud
        uses: google-github-actions/auth@v2
        with:
          credentials_json: ${{ steps.prepare-json.outputs.credentials_json }}

      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          project_id: ${{ secrets.GCP_PROJECT_ID }}

      - name: Enable required APIs
        run: |
          gcloud services enable run.googleapis.com --project=${{ secrets.GCP_PROJECT_ID }} || true
          gcloud services enable cloudbuild.googleapis.com --project=${{ secrets.GCP_PROJECT_ID }} || true
          gcloud services enable artifactregistry.googleapis.com --project=${{ secrets.GCP_PROJECT_ID }} || true

      - name: Grant required permissions to service account
        continue-on-error: true
        run: |
          SA_EMAIL=$(gcloud config get-value account 2>/dev/null)
          PROJECT_ID="${{ secrets.GCP_PROJECT_ID }}"
          
          echo "Attempting to grant permissions to: $SA_EMAIL"
          echo "Project: $PROJECT_ID"
          echo ""
          
          echo "Granting Cloud Run Admin role..."
          gcloud projects add-iam-policy-binding $PROJECT_ID \
            --member="serviceAccount:$SA_EMAIL" \
            --role="roles/run.admin" \
            --condition=None || echo "⚠️  Could not grant Cloud Run Admin (may already have it or insufficient permissions)"
          
          echo "Granting Service Account User role..."
          gcloud projects add-iam-policy-binding $PROJECT_ID \
            --member="serviceAccount:$SA_EMAIL" \
            --role="roles/iam.serviceAccountUser" \
            --condition=None || echo "⚠️  Could not grant Service Account User (may already have it or insufficient permissions)"
          
          echo "Granting Cloud Build Editor role..."
          gcloud projects add-iam-policy-binding $PROJECT_ID \
            --member="serviceAccount:$SA_EMAIL" \
            --role="roles/cloudbuild.builds.editor" \
            --condition=None || echo "⚠️  Could not grant Cloud Build Editor (may already have it or insufficient permissions)"
          
          echo ""
          echo "✅ Permission grant attempt completed. Waiting 10 seconds for propagation..."
          sleep 10

      - name: Deploy Company Lookup Service
        working-directory: ./hackathon
        env:
          APIFY_API_TOKEN: ${{ secrets.APIFY_API_TOKEN }}
          DEEPSEEK_API: ${{ secrets.DEEPSEEK_API }}
          DEBUG: ${{ secrets.DEBUG }}
        run: |
          echo "Deploying Company Lookup API to Cloud Run..."
          
          echo "=== Verifying source code ==="
          echo "Checking api_company_lookup.py..."
          
          cp Dockerfile.company Dockerfile
          
          ENV_VARS="APIFY_API_TOKEN=${APIFY_API_TOKEN}"
          
          if [ -n "${DEEPSEEK_API}" ]; then
            ENV_VARS="${ENV_VARS},DEEPSEEK_API=${DEEPSEEK_API}"
          fi
          
          if [ -n "${DEBUG}" ]; then
            ENV_VARS="${ENV_VARS},DEBUG=${DEBUG}"
          fi
          
          echo "✅ Environment variables configured:"
          echo "   - APIFY_API_TOKEN: ${APIFY_API_TOKEN:+✅ set (length: ${#APIFY_API_TOKEN})}"
          echo "   - DEEPSEEK_API: ${DEEPSEEK_API:+✅ set (length: ${#DEEPSEEK_API})}${DEEPSEEK_API:-❌ not set}"
          echo "   - DEBUG: ${DEBUG:-not set}"
          
          echo "Building and deploying to Cloud Run..."
          echo "Forcing rebuild by adding timestamp to Dockerfile..."
          echo "# Build timestamp: $(date +%s)" >> Dockerfile
          
          if ! gcloud run deploy company-lookup-api \
            --source . \
            --region "${{ env.GCP_REGION }}" \
            --platform managed \
            --allow-unauthenticated \
            --set-env-vars "${ENV_VARS}" \
            --memory 2Gi \
            --cpu 2 \
            --timeout 3600 \
            --max-instances 10 \
            --project "${{ env.GCP_PROJECT_ID }}" \
            --no-traffic 2>&1 | tee /tmp/deploy.log; then
            echo "❌ Deployment failed. Checking logs..."
            echo ""
            echo "=== Deployment Output ==="
            cat /tmp/deploy.log || true
            echo ""
            echo "=== Checking Cloud Build Logs ==="
            BUILD_ID=$(gcloud builds list \
              --project "${{ env.GCP_PROJECT_ID }}" \
              --limit 1 \
              --format="value(id)" \
              --filter="source.storageSource.bucket~'gcf-sources' OR source.storageSource.bucket~'artifacts'") || echo ""
            
            if [ -n "$BUILD_ID" ]; then
              echo "Latest build ID: $BUILD_ID"
              echo ""
              echo "--- Build Logs (last 100 lines) ---"
              gcloud builds log "$BUILD_ID" \
                --project "${{ env.GCP_PROJECT_ID }}" \
                --limit 100 || true
            else
              echo "⚠️  Could not find build ID. Checking recent builds..."
              gcloud builds list \
                --project "${{ env.GCP_PROJECT_ID }}" \
                --limit 5 \
                --format="table(id,status,createTime,source.repoSource.branchName)" || true
            fi
            
            echo ""
            echo "=== Cloud Run Service Status ==="
            gcloud run services describe company-lookup-api \
              --region "${{ env.GCP_REGION }}" \
              --project "${{ env.GCP_PROJECT_ID }}" \
              --format="yaml" || echo "⚠️  Service may not exist yet"
            
            echo ""
            echo "=== Cloud Run Revision Logs ==="
            LATEST_REVISION=$(gcloud run revisions list \
              --service=company-lookup-api \
              --region="${{ env.GCP_REGION }}" \
              --project="${{ env.GCP_PROJECT_ID }}" \
              --format="value(name)" \
              --limit=1) || echo ""
            
            if [ -n "$LATEST_REVISION" ]; then
              echo "Latest revision: $LATEST_REVISION"
              echo ""
              echo "--- Recent logs (last 50) ---"
              gcloud logging read "resource.type=cloud_run_revision AND resource.labels.service_name=company-lookup-api AND resource.labels.revision_name=$LATEST_REVISION" \
                --limit 50 \
                --project "${{ env.GCP_PROJECT_ID }}" \
                --format="table(timestamp,severity,textPayload,jsonPayload.message)" || true
            else
              echo "--- Recent logs (last 50) ---"
              gcloud logging read "resource.type=cloud_run_revision AND resource.labels.service_name=company-lookup-api" \
                --limit 50 \
                --project "${{ env.GCP_PROJECT_ID }}" \
                --format="table(timestamp,severity,textPayload,jsonPayload.message)" || true
            fi
            
            echo ""
            echo "=== Logs URLs ==="
            echo "Cloud Build Logs:"
            echo "https://console.cloud.google.com/cloud-build/builds?project=${{ env.GCP_PROJECT_ID }}"
            echo ""
            echo "Cloud Run Logs:"
            echo "https://console.cloud.google.com/logs/query?project=${{ env.GCP_PROJECT_ID }}&query=resource.type%3D%22cloud_run_revision%22%0Aresource.labels.service_name%3D%22company-lookup-api%22"
            exit 1
          fi
          
          rm -f Dockerfile
          

      - name: Get service URL
        run: |
          SERVICE_URL=$(gcloud run services describe company-lookup-api \
            --region "${{ env.GCP_REGION }}" \
            --project "${{ env.GCP_PROJECT_ID }}" \
            --format 'value(status.url)')
          echo "✅ Company Lookup API deployed at: $SERVICE_URL"
          echo "::set-output name=url::$SERVICE_URL"

  deploy-google-search:
    name: Deploy Google Search API
    runs-on: ubuntu-latest
    
    if: github.event_name == 'push' || github.event_name == 'workflow_dispatch'
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Prepare Google Service Account JSON
        id: prepare-json
        run: |
          SECRET_VALUE="${{ secrets.GOOGLE_JSON }}"
          if [ -z "$SECRET_VALUE" ]; then
            echo "❌ Error: GOOGLE_JSON secret is empty or not set"
            exit 1
          fi
          if echo "$SECRET_VALUE" | base64 -d > /tmp/gcp-sa-key.json 2>/dev/null && [ -s /tmp/gcp-sa-key.json ]; then
            echo "✅ Decoded from base64"
          else
            echo "$SECRET_VALUE" > /tmp/gcp-sa-key.json
            echo "✅ Used as plain JSON"
          fi
          if [ ! -s /tmp/gcp-sa-key.json ]; then
            echo "❌ Error: Failed to prepare credentials file"
            exit 1
          fi
          delimiter="EOF_$(date +%s)_$$"
          echo "credentials_json<<${delimiter}" >> $GITHUB_OUTPUT
          cat /tmp/gcp-sa-key.json >> $GITHUB_OUTPUT
          echo "${delimiter}" >> $GITHUB_OUTPUT

      - name: Authenticate to Google Cloud
        uses: google-github-actions/auth@v2
        with:
          credentials_json: ${{ steps.prepare-json.outputs.credentials_json }}

      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          project_id: ${{ secrets.GCP_PROJECT_ID }}

      - name: Enable required APIs
        run: |
          gcloud services enable run.googleapis.com --project=${{ secrets.GCP_PROJECT_ID }} || true
          gcloud services enable cloudbuild.googleapis.com --project=${{ secrets.GCP_PROJECT_ID }} || true
          gcloud services enable artifactregistry.googleapis.com --project=${{ secrets.GCP_PROJECT_ID }} || true

      - name: Deploy Google Search Service
        working-directory: ./hackathon
        env:
          APIFY_API_TOKEN: ${{ secrets.APIFY_API_TOKEN }}
          DEBUG: ${{ secrets.DEBUG }}
        run: |
          echo "Deploying Google Search API to Cloud Run..."
          
          cp Dockerfile.google Dockerfile
          
          ENV_VARS="APIFY_API_TOKEN=${APIFY_API_TOKEN}"
          
          if [ -n "${DEBUG}" ]; then
            ENV_VARS="${ENV_VARS},DEBUG=${DEBUG}"
          fi
          
          echo "Building and deploying to Cloud Run..."
          gcloud run deploy google-search-api \
            --source . \
            --region "${{ env.GCP_REGION }}" \
            --platform managed \
            --allow-unauthenticated \
            --set-env-vars "${ENV_VARS}" \
            --memory 2Gi \
            --cpu 2 \
            --timeout 3600 \
            --max-instances 10 \
            --project "${{ env.GCP_PROJECT_ID }}"
          
          rm -f Dockerfile
          

      - name: Get service URL
        run: |
          SERVICE_URL=$(gcloud run services describe google-search-api \
            --region "${{ env.GCP_REGION }}" \
            --project "${{ env.GCP_PROJECT_ID }}" \
            --format 'value(status.url)')
          echo "✅ Google Search API deployed at: $SERVICE_URL"
          echo "::set-output name=url::$SERVICE_URL"

  deploy-instagram-search:
    name: Deploy Instagram Search API
    runs-on: ubuntu-latest
    
    if: github.event_name == 'push' || github.event_name == 'workflow_dispatch'
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Prepare Google Service Account JSON
        id: prepare-json
        run: |
          SECRET_VALUE="${{ secrets.GOOGLE_JSON }}"
          if [ -z "$SECRET_VALUE" ]; then
            echo "❌ Error: GOOGLE_JSON secret is empty or not set"
            exit 1
          fi
          if echo "$SECRET_VALUE" | base64 -d > /tmp/gcp-sa-key.json 2>/dev/null && [ -s /tmp/gcp-sa-key.json ]; then
            echo "✅ Decoded from base64"
          else
            echo "$SECRET_VALUE" > /tmp/gcp-sa-key.json
            echo "✅ Used as plain JSON"
          fi
          if [ ! -s /tmp/gcp-sa-key.json ]; then
            echo "❌ Error: Failed to prepare credentials file"
            exit 1
          fi
          delimiter="EOF_$(date +%s)_$$"
          echo "credentials_json<<${delimiter}" >> $GITHUB_OUTPUT
          cat /tmp/gcp-sa-key.json >> $GITHUB_OUTPUT
          echo "${delimiter}" >> $GITHUB_OUTPUT

      - name: Authenticate to Google Cloud
        uses: google-github-actions/auth@v2
        with:
          credentials_json: ${{ steps.prepare-json.outputs.credentials_json }}

      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          project_id: ${{ secrets.GCP_PROJECT_ID }}

      - name: Enable required APIs
        run: |
          gcloud services enable run.googleapis.com --project=${{ secrets.GCP_PROJECT_ID }} || true
          gcloud services enable cloudbuild.googleapis.com --project=${{ secrets.GCP_PROJECT_ID }} || true
          gcloud services enable artifactregistry.googleapis.com --project=${{ secrets.GCP_PROJECT_ID }} || true

      - name: Deploy Instagram Search Service
        working-directory: ./hackathon
        env:
          APIFY_API_TOKEN: ${{ secrets.APIFY_API_TOKEN }}
          DEBUG: ${{ secrets.DEBUG }}
        run: |
          echo "Deploying Instagram Search API to Cloud Run..."
          
          cp Dockerfile.instagram Dockerfile
          
          ENV_VARS="APIFY_API_TOKEN=${APIFY_API_TOKEN}"
          
          if [ -n "${DEBUG}" ]; then
            ENV_VARS="${ENV_VARS},DEBUG=${DEBUG}"
          fi
          
          echo "Building and deploying to Cloud Run..."
          gcloud run deploy instagram-search-api \
            --source . \
            --region "${{ env.GCP_REGION }}" \
            --platform managed \
            --allow-unauthenticated \
            --set-env-vars "${ENV_VARS}" \
            --memory 2Gi \
            --cpu 2 \
            --timeout 3600 \
            --max-instances 10 \
            --project "${{ env.GCP_PROJECT_ID }}"
          
          rm -f Dockerfile
          

      - name: Get service URL
        run: |
          SERVICE_URL=$(gcloud run services describe instagram-search-api \
            --region "${{ env.GCP_REGION }}" \
            --project "${{ env.GCP_PROJECT_ID }}" \
            --format 'value(status.url)')
          echo "✅ Instagram Search API deployed at: $SERVICE_URL"
          echo "::set-output name=url::$SERVICE_URL"

  deploy-tiktok-search:
    name: Deploy TikTok Search API
    runs-on: ubuntu-latest
    
    if: github.event_name == 'push' || github.event_name == 'workflow_dispatch'
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Prepare Google Service Account JSON
        id: prepare-json
        run: |
          SECRET_VALUE="${{ secrets.GOOGLE_JSON }}"
          if [ -z "$SECRET_VALUE" ]; then
            echo "❌ Error: GOOGLE_JSON secret is empty or not set"
            exit 1
          fi
          if echo "$SECRET_VALUE" | base64 -d > /tmp/gcp-sa-key.json 2>/dev/null && [ -s /tmp/gcp-sa-key.json ]; then
            echo "✅ Decoded from base64"
          else
            echo "$SECRET_VALUE" > /tmp/gcp-sa-key.json
            echo "✅ Used as plain JSON"
          fi
          if [ ! -s /tmp/gcp-sa-key.json ]; then
            echo "❌ Error: Failed to prepare credentials file"
            exit 1
          fi
          delimiter="EOF_$(date +%s)_$$"
          echo "credentials_json<<${delimiter}" >> $GITHUB_OUTPUT
          cat /tmp/gcp-sa-key.json >> $GITHUB_OUTPUT
          echo "${delimiter}" >> $GITHUB_OUTPUT

      - name: Authenticate to Google Cloud
        uses: google-github-actions/auth@v2
        with:
          credentials_json: ${{ steps.prepare-json.outputs.credentials_json }}

      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          project_id: ${{ secrets.GCP_PROJECT_ID }}

      - name: Enable required APIs
        run: |
          gcloud services enable run.googleapis.com --project=${{ secrets.GCP_PROJECT_ID }} || true
          gcloud services enable cloudbuild.googleapis.com --project=${{ secrets.GCP_PROJECT_ID }} || true
          gcloud services enable artifactregistry.googleapis.com --project=${{ secrets.GCP_PROJECT_ID }} || true

      - name: Deploy TikTok Search Service
        working-directory: ./hackathon
        env:
          APIFY_API_TOKEN: ${{ secrets.APIFY_API_TOKEN }}
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
          DEBUG: ${{ secrets.DEBUG }}
        run: |
          echo "Deploying TikTok Search API to Cloud Run..."
          
          cp Dockerfile.tiktok Dockerfile
          
          ENV_VARS="APIFY_API_TOKEN=${APIFY_API_TOKEN}"
          
          if [ -n "${SUPABASE_URL}" ]; then
            ENV_VARS="${ENV_VARS},SUPABASE_URL=${SUPABASE_URL}"
          fi
          
          if [ -n "${SUPABASE_KEY}" ]; then
            ENV_VARS="${ENV_VARS},SUPABASE_KEY=${SUPABASE_KEY}"
          fi
          
          if [ -n "${DEBUG}" ]; then
            ENV_VARS="${ENV_VARS},DEBUG=${DEBUG}"
          fi
          
          echo "✅ Environment variables configured:"
          echo "   - APIFY_API_TOKEN: ${APIFY_API_TOKEN:+✅ set (length: ${#APIFY_API_TOKEN})}"
          echo "   - SUPABASE_URL: ${SUPABASE_URL:+✅ set}${SUPABASE_URL:-❌ not set}"
          echo "   - SUPABASE_KEY: ${SUPABASE_KEY:+✅ set (length: ${#SUPABASE_KEY})}${SUPABASE_KEY:-❌ not set}"
          echo "   - DEBUG: ${DEBUG:-not set}"
          
          echo "Building and deploying to Cloud Run..."
          echo "Forcing rebuild by adding timestamp to Dockerfile..."
          echo "# Build timestamp: $(date +%s)" >> Dockerfile
          
          SERVICE_EXISTS=$(gcloud run services list --project="${{ env.GCP_PROJECT_ID }}" --region="${{ env.GCP_REGION }}" --filter="metadata.name=tiktok-search-api" --format="value(metadata.name)" || echo "")
          
          DEPLOY_FLAGS=""
          if [ -n "$SERVICE_EXISTS" ]; then
            echo "Service 'tiktok-search-api' already exists. Deploying with --no-traffic."
            DEPLOY_FLAGS="--no-traffic"
          else
            echo "Service 'tiktok-search-api' does not exist. Creating new service."
          fi
          
          if ! gcloud run deploy tiktok-search-api \
            --source . \
            --region "${{ env.GCP_REGION }}" \
            --platform managed \
            --allow-unauthenticated \
            --set-env-vars "${ENV_VARS}" \
            --memory 2Gi \
            --cpu 2 \
            --timeout 3600 \
            --max-instances 10 \
            --project "${{ env.GCP_PROJECT_ID }}" \
            ${DEPLOY_FLAGS} 2>&1 | tee /tmp/deploy.log; then
            echo "❌ Deployment failed. Checking logs..."
            echo ""
            echo "=== Deployment Output ==="
            cat /tmp/deploy.log || true
            echo ""
            echo "=== Checking Cloud Build Logs ==="
            BUILD_ID=$(gcloud builds list \
              --project "${{ env.GCP_PROJECT_ID }}" \
              --limit 1 \
              --format="value(id)" \
              --filter="source.storageSource.bucket~'gcf-sources' OR source.storageSource.bucket~'artifacts'") || echo ""
            
            if [ -n "$BUILD_ID" ]; then
              echo "Latest build ID: $BUILD_ID"
              echo ""
              echo "--- Build Logs (last 100 lines) ---"
              gcloud builds log "$BUILD_ID" \
                --project "${{ env.GCP_PROJECT_ID }}" \
                --limit 100 || true
            fi
            
            echo ""
            echo "=== Cloud Run Service Status ==="
            gcloud run services describe tiktok-search-api \
              --region "${{ env.GCP_REGION }}" \
              --project "${{ env.GCP_PROJECT_ID }}" \
              --format="yaml" || echo "⚠️  Service may not exist yet"
            
            echo ""
            echo "=== Logs URLs ==="
            echo "Cloud Build Logs:"
            echo "https://console.cloud.google.com/cloud-build/builds?project=${{ env.GCP_PROJECT_ID }}"
            echo ""
            echo "Cloud Run Logs:"
            echo "https://console.cloud.google.com/logs/query?project=${{ env.GCP_PROJECT_ID }}&query=resource.type%3D%22cloud_run_revision%22%0Aresource.labels.service_name%3D%22tiktok-search-api%22"
            exit 1
          fi
          
          echo "✅ Deployment successful."
          if [ -n "$SERVICE_EXISTS" ]; then
            echo "Setting traffic to latest revision..."
            gcloud run services update-traffic tiktok-search-api \
              --to-latest \
              --region "${{ env.GCP_REGION }}" \
              --project "${{ env.GCP_PROJECT_ID }}"
          fi
          rm -f Dockerfile

      - name: Get service URL
        run: |
          SERVICE_URL=$(gcloud run services describe tiktok-search-api \
            --region "${{ env.GCP_REGION }}" \
            --project "${{ env.GCP_PROJECT_ID }}" \
            --format 'value(status.url)')
          echo "✅ TikTok Search API deployed at: $SERVICE_URL"
          echo "::set-output name=url::$SERVICE_URL"

  validate:
    name: Validate deployment configuration
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Validate Dockerfile
        working-directory: ./hackathon
        run: |
          if [ ! -f Dockerfile ]; then
            echo "❌ Dockerfile not found"
            exit 1
          fi
          echo "✅ Dockerfile found"

      - name: Validate requirements.txt
        working-directory: ./hackathon
        run: |
          if [ ! -f requirements.txt ]; then
            echo "❌ requirements.txt not found"
            exit 1
          fi
          echo "✅ requirements.txt found"

      - name: Validate source code
        working-directory: ./hackathon
        run: |
          if [ ! -d src ]; then
            echo "❌ src directory not found"
            exit 1
          fi
          echo "✅ Source code structure valid"
      
      - name: Validate API files
        working-directory: ./hackathon
        run: |
          if [ ! -f src/api_company_lookup.py ]; then
            echo "❌ src/api_company_lookup.py not found"
            exit 1
          fi
          if [ ! -f src/api_google_search.py ]; then
            echo "❌ src/api_google_search.py not found"
            exit 1
          fi
          if [ ! -f src/api_instagram_search.py ]; then
            echo "❌ src/api_instagram_search.py not found"
            exit 1
          fi
          if [ ! -f src/api_global_search.py ]; then
            echo "❌ src/api_global_search.py not found"
            exit 1
          fi
          echo "✅ All API files found"
      
      - name: Validate Dockerfiles
        working-directory: ./hackathon
        run: |
          if [ ! -f Dockerfile.company ]; then
            echo "❌ Dockerfile.company not found"
            exit 1
          fi
          if [ ! -f Dockerfile.google ]; then
            echo "❌ Dockerfile.google not found"
            exit 1
          fi
          if [ ! -f Dockerfile.instagram ]; then
            echo "❌ Dockerfile.instagram not found"
            exit 1
          fi
          if [ ! -f Dockerfile.tiktok ]; then
            echo "❌ Dockerfile.tiktok not found"
            exit 1
          fi
          echo "✅ All Dockerfiles found"

